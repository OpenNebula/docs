.. _fireedge_auth:

=======================
Fireedge Authentication
=======================

By default Fireedge works with the default ``core`` authentication method (user and password) although you can configure any authentication mechanism supported by OpenNebula. In this section you will learn how to enable other authentication.

* **Web client and Fireedge server**. Authentication is based on the credentials stored in the OpenNebula database for the user. Depending on the type of these credentials the authentication method can be: ``remote`` and ``opennebula``

The following sections explain the client-to-Sunstone server authentication methods.

Basic Auth
===========

In the basic mode, username and password are matched to those in OpenNebula's database in order to authorize the user at the time of login. JWT-based sessions are then used to authenticate and authorize the requests.

.. code-block:: yaml

    :auth: opennebula

Remote Auth
===========

This method performs OpenNebula login based on user extraction and compares it with the password value in the user database.

To update existing users to use remote authentication, change the controller to public and update the password as follows:

The user password has to be changed by running one of the following commands:

.. prompt:: bash $ auto

    $ oneuser chauth johndoe public "johndoe"

New users with this authentication method should be created as follows:

.. prompt:: bash $ auto

    $ oneuser create johndoe "johndoe" --driver public

To enable this login method, set the ``:auth:`` option in ``/etc/one/sunstone-server.conf`` to ``remote`` and restart Sunstone:

.. code-block:: yaml

    :auth: remote

The login screen will not display the username and password fields anymore, as all information is fetched from the user certificate:

|fireedge_remote_login|

Note that OpenNebula will not verify that the user holds a valid certificate at the time of login: this is expected to be done by the external container of the Fireedge server (normally Apache), whose job is to tell the user's browser that the site requires a user certificate and to check that the certificate is consistently signed by the chosen Certificate Authority (CA).

.. warning:: The Fireedge authentication only handles the authentication of the user at the time of login. Authentication of the user certificate is a complementary setup, which can rely on Apache.

.. _2f_auth_fireedge:

Two Factor Authentication
=========================

You can get an additional authentication level by using a two-factor authentication that not only requests the username and password but also the one-time (or pregenerated security) keys generated by an authenticator application.

|fireedge_2fa_auth|

Authenticator App
------------------

This method requires a token generated by any of these applications: `Google Authentication <https://play.google.com/store/apps/details?id=com.google.android.apps.authenticator2&hl=en>`__, `Authy <https://authy.com/download/>`__ or `Microsoft Authentication <https://www.microsoft.com/en-us/p/microsoft-authenticator/9nblgggzmcj6?activetab=pivot:overviewtab>`__.

To enable this, you must follow these steps:

-  Log in to Sunstone and select menu **Setting**. Inside, find and select the tab **Auth**.
-  Inside, find and select the button **Manage two factor authentication** and **Register authenticator app**.

|sunstone_settings_auth|

-  A window will appear with a QR code. It must be scanned with your authenticator app. That will generate a 6-character code that you must place in the code input field.

|sunstone_settings_2fa_app|

Internally Sunstone adds the field ``TWO_FACTOR_AUTH_SECRET``.

|sunstone_template_user_auth|

-  To disable 2FA, go to the **Settings**, **Auth** tab and click remove button.

|sunstone_settings_2fa_result|


.. |fireedge_remote_login| image:: /images/fireedge_login_remote.png
.. |fireedge_2fa_auth| image:: /images/fireedge_login_2fa.png
.. |sunstone_settings_auth| image:: /images/sunstone-settings-auth.png
.. |sunstone_settings_2fa_app| image:: /images/sunstone-settings-2fa-app.png
.. |sunstone_settings_2fa_keys| image:: /images/sunstone-settings-2fa-keys.png
.. |sunstone_settings_2fa_result| image:: /images/sunstone-settings-2fa-result.png
.. |sunstone_template_user_auth| image:: /images/sunstone-template-user-auth.png
