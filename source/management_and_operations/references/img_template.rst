.. _img_template:

================================================================================
Image Definition Template
================================================================================

This page describes how to define a new image template. An image template follows the same syntax as the :ref:`VM template <template>`.

If you want to learn more about the image repository, you can do so :ref:`here <img_guide>`.

.. warning:: There are some template attributes that can compromise the security of the system or the security of other VMs, and can be used **only** by users in the oneadmin group. These attributes can be configured in :ref:`oned.conf <oned_conf>`, the default ones are labeled with ``*`` in the following tables. See the complete list in the :ref:`Restricted Attributes <img_template_restricted_attributes>` section.

Template Attributes
================================================================================

The following attributes can be defined in the template.

+---------------------------+--------------------------+--------------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|      Attribute            |           KVM            |  vCenter                 |                                                                                                       Value                                                                                                       |                                                                                                                                                                                 Description                                                                                                                                                                                  |
+===========================+==========================+==========================+===================================================================================================================================================================================================================+==============================================================================================================================================================================================================================================================================================================================================================================+
| **NAME**                  | Mandatory                | Mandatory                | Any string                                                                                                                                                                                                        | Name that the Image will get. Every image must have a unique name.                                                                                                                                                                                                                                                                                                           |
+---------------------------+--------------------------+--------------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| **DESCRIPTION**           | Optional                 | Optional                 | Any string                                                                                                                                                                                                        | Human readable description of the image for other users.                                                                                                                                                                                                                                                                                                                     |
+---------------------------+--------------------------+--------------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| **TYPE**                  | Optional                 | Optional                 | ``OS, CDROM, DATABLOCK`` for both KVM and vCenter, ``KERNEL``, ``RAMDISK``, ``CONTEXT``                                                                                                                           | Type of the image, explained in detail in the following section. If omitted, the default value is the one defined in oned.conf (install default is OS).                                                                                                                                                                                                                      |
+---------------------------+--------------------------+--------------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| **PERSISTENT**            | Optional                 | Optional                 | ``YES``, ``NO``                                                                                                                                                                                                   | Persistence of the image. If omitted, the default value is ``NO``.                                                                                                                                                                                                                                                                                                           |
+---------------------------+--------------------------+--------------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| **PERSISTENT\_TYPE**      | Optional                 | \-                       | ``IMMUTABLE``, ``SHAREABLE``                                                                                                                                                                                      | | ``IMMUTABLE`` - An special persistent image, that will not be modified.                                                                                                                                                                                                                                                                                                    |
|                           |                          |                          |                                                                                                                                                                                                                   | | ``SHAREABLE`` - Persistent image shareable by multiple VMs. Requires ``raw`` image ``FORMAT`` and shared datastore. :ref:`Virtualization driver <oned_conf_virtualization_drivers>` needs ``SUPPORT_SHAREABLE = "yes"``                                                                                                                                                    |
|                           |                          |                          |                                                                                                                                                                                                                   | | This attribute should only be used for special storage configurations.                                                                                                                                                                                                                                                                                                     |
+---------------------------+--------------------------+--------------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| **DEV\_PREFIX**           | Optional                 | Optional                 | Any string e.g sd, hd                                                                                                                                                                                             | Prefix for the emulated device this image will be mounted at. For instance, ``hd``, ``sd``, or ``vd`` for KVM virtio. If omitted, the default value is the one defined in :ref:`oned.conf <oned_conf>` (installation default is ``hd``).                                                                                                                                     |
+---------------------------+--------------------------+--------------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| **TARGET**                | Optional                 | \-                       | Any string                                                                                                                                                                                                        | Target for the emulated device this image will be mounted at. For instance, ``hdb``, ``sdc``. If omitted, it will be :ref:`assigned automatically <template_disks_device_mapping>`.                                                                                                                                                                                          |
+---------------------------+--------------------------+--------------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| **FORMAT**                | Optional                 | \-                       | ``raw`` or ``qcow2``                                                                                                                                                                                              | Format of the image backing file.                                                                                                                                                                                                                                                                                                                                            |
+---------------------------+--------------------------+--------------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| **FS**                    | Optional                 | \-                       | File system name (e.g ext4, xfs, ...)                                                                                                                                                                             | Specific file system type. It is used for formatting datablocks and volatile disks.                                                                                                                                                                                                                                                                                          |
+---------------------------+--------------------------+--------------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| **PATH**                  | Mandatory (if no SOURCE) | Mandatory (if no SOURCE) | Any string                                                                                                                                                                                                        | Path to the original file that will be copied to the image repository. If not specified for a DATABLOCK type image, an empty image will be created. Note that gzipped files are supported and OpenNebula will automatically decompress them. Bzip2 compressed files is also supported, but it's strongly discouraged since OpenNebula will not calculate it's size properly. |
+---------------------------+--------------------------+--------------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| **SOURCE\***              | Mandatory (if no PATH)   | Mandatory (if no PATH)   | Any string                                                                                                                                                                                                        | Source to be used in the DISK attribute. Useful for not file-based images.                                                                                                                                                                                                                                                                                                   |
+---------------------------+--------------------------+--------------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| **DISK\_TYPE**            | Optional                 | Optional                 | For KVM: ``BLOCK``, ``CDROM`` or ``FILE`` (default). For vCenter: ``FILE``                                                                                                                                        | This is the type of the supporting media for the image: a block device (``BLOCK``) an ISO-9660 file or readonly block device (``CDROM``) or a plain file (``FILE``).                                                                                                                                                                                                         |
+---------------------------+--------------------------+--------------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| **VCENTER_DISK\_TYPE**    | \-                       | Optional                 | vCenter: (careful with the case): delta, eagerZeroedThick, flatMonolithic, preallocated, raw, rdm, rdmp, seSparse, sparse2Gb, sparseMonolithic, thick, thick2Gb, thin                                             | The type of disk has implications on performance and occupied space. Values (careful with the case): delta, eagerZeroedThick, flatMonolithic, preallocated, raw, rdm, rdmp, seSparse, sparse2Gb, sparseMonolithic, thick, thick2Gb, thin.                                                                                                                                    |
|                           |                          |                          |                                                                                                                                                                                                                   | More information `in the VMware documentation <http://pubs.vmware.com/vsphere-60/index.jsp?topic=%2Fcom.vmware.wssdk.apiref.doc%2Fvim.VirtualDiskManager.VirtualDiskType.html>`__.                                                                                                                                                                                           |
+---------------------------+--------------------------+--------------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| **VCENTER_ADAPTER\_TYPE** | \-                       | Optional                 | vCenter: Possible values (careful with the case): lsiLogic, ide, busLogic.                                                                                                                                        | Type of controller to be used with this disk. More information `in the VMware documentation <http://pubs.vmware.com/vsphere-60/index.jsp#com.vmware.wssdk.apiref.doc/vim.VirtualDiskManager.VirtualDiskAdapterType.html>`__                                                                                                                                                  |
+---------------------------+--------------------------+--------------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| **READONLY**              | Optional                 | \-                       | ``YES``, ``NO``.                                                                                                                                                                                                  | This attribute should only be used for special storage configurations. It sets how the image is going to be exposed to the hypervisor. Images of type ``CDROM`` and those with PERSISTENT\_TYPE set to ``IMMUTABLE`` will have ``READONLY`` set to ``YES``. Otherwise, by default it is set to ``NO``.                                                                       |
+---------------------------+--------------------------+--------------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| **MD5**                   | Optional                 | Optional                 | An md5 hash                                                                                                                                                                                                       | MD5 hash to check for image integrity                                                                                                                                                                                                                                                                                                                                        |
+---------------------------+--------------------------+--------------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| **SHA1**                  | Optional                 | Optional                 | An sha1 hash                                                                                                                                                                                                      | SHA1 hash to check for image integrity                                                                                                                                                                                                                                                                                                                                       |
+---------------------------+--------------------------+--------------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| **VCENTER_IMPORTED**      | \-                       | Optional                 | ``YES``                                                                                                                                                                                                           | vCenter: This attribute is set to YES automatically when an IMAGE has been imported e.g an imported template or Wild VM. If set to YES, OpenNebula won't remove from vCenter this image when the image is deleted from OpenNebula                                                                                                                                            |
+---------------------------+--------------------------+--------------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+

.. warning:: Be careful when ``PATH`` points to a compressed bz2 image, since although it will work, OpenNebula will not calculate its size correctly.

Mandatory attributes for ``DATABLOCK`` images with no ``PATH`` set:

+--------------+--------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| Attribute    | Value        | Description                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
+==============+==============+==============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================+
| **SIZE**     | An integer   | Size in MB.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
+--------------+--------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+

Template Examples
================================================================================

Example of an OS image:

.. code::

    NAME          = "Ubuntu Web Development"
    PATH          = /home/one_user/images/ubuntu_desktop.img
    DESCRIPTION   = "Ubuntu 10.04 desktop for Web Development students.
    Contains the pdf lessons and exercises as well as all the necessary
    programming tools and testing frameworks."

Example of a CDROM image:

.. code::

    NAME          = "MATLAB install CD"
    TYPE          = CDROM
    PATH          = /home/one_user/images/matlab.iso
    DESCRIPTION   = "Contains the MATLAB installation files. Mount it to install MATLAB on new OS images."

Example of a DATABLOCK image:

.. code::

    NAME          = "Experiment results"
    TYPE          = DATABLOCK
    # No PATH set, this image will start as a new empty disk
    SIZE          = 3.08
    DESCRIPTION   = "Storage for my Thesis experiments."

.. _img_template_restricted_attributes:

Restricted Attributes
================================================================================

All the **default** restricted attributes to users in the oneadmin group are summarized in the following list:

-  SOURCE
