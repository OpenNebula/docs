.. _known_issues:

================================================================================
Known Issues
================================================================================

A complete list of `known issues for OpenNebula is maintained here <https://github.com/OpenNebula/one/issues?q=is%3Aopen+is%3Aissue+label%3A%22Type%3A+Bug%22+label%3A%22Status%3A+Accepted%22>`__.

This page will be updated with relevant information about bugs affecting OpenNebula, as well as possible workarounds, until a patch is officially published.

NIC alias and IP spoofing rules
================================================================================

For a NIC alias the IP spoofing rules are not triggered when the VM is created nor when the interface is attached. If you have configured IP spoofing for your virtual networks be aware that those will not be honored by NIC ALIAS interfaces. More info `here <https://github.com/OpenNebula/one/issues/3079>`__.

Wilds with snapshots in vCenter
================================================================================

Currently, OpenNebula does not support importing a Wild with snapshots into vCenter. Before importing a Wild in vCenter you must remove all snapshots. More information can be found `here <https://github.com/OpenNebula/one/issues/1268>`__.

CLI warning message
===================

Using some CLI commands in Ubuntu 18.04, due to ruby and gem versions, you may see this message:

``warning: constant ::Fixnum is deprecated``

As a workaround you can use ``export RUBYOPT="-W0``. This will disable the warning message (but, take into account that it will disable all warning messages from ruby).

Raw Device Mapping and system datastores
========================================

If you try to deploy a VM using an image from an RDM datastore into an ssh or shared datastore you might get an incompatibility error. To fix this you need to state the following config in **/etc/one/oned.conf**

.. code-block:: bash

    TM_MAD_CONF = [
    NAME = "dev", LN_TARGET = "NONE", CLONE_TARGET = "NONE", SHARED = "YES",
    TM_MAD_SYSTEM = "ssh,shared", LN_TARGET_SSH = "SYSTEM", CLONE_TARGET_SSH = "SYSTEM",
    DISK_TYPE_SSH = "BLOCK", LN_TARGET_SHARED = "NONE",
    CLONE_TARGET_SHARED = "SELF", DISK_TYPE_SHARED = "BLOCK"

Saturation in Hook Subsystem
============================

In high load environments it is possible that the hook driver (one_hm) is not able to process the events generated by API calls. This causes that the events are queued in oned process buffer, and as such causes an increase in memory consumption that can lead to a OOM event.

In the scenarios reviewed where this issue appears, disabling the reporting .info API calls alleviates the problem. Hence this will be disabled in future versions. As a workaround, a new oned process can be compiled with this `commit <https://github.com/OpenNebula/one/commit/5ba128ee7044f8b5e61772f03dcbcb89cfe3c2f8>`__ that disables reporting of .info API calls to the hook subsystem.

Onedb upgrade overwirtes DB encoding
====================================

When running ``onedb upgrade`` and if the DB tables have different encoding from UTF-8, it overwirtes the tables using a wrong encoding. This leads to a non-compatible encoding and errors at the XML-RPC level.

As a workaround you can change the value of **NOKOGIRI_ENCODING** in the file `/usr/bin/onedb` and put there your encoding according to the DB table encoding in your case. You can find `here <https://www.rubydoc.info/github/sparklemotion/nokogiri/Nokogiri/XML/SAX/Parser>`__ the appropiate enconding.

Random failures when getting Host objects after the upgrade
===========================================================

Sometimes during the upgrade process the new host attribute ``PREV_STATE`` is not created. This leads to an error every time OpenNebula tries to perform an action over the host.

For fixing it just update the host using ``onedb update-body host --id <host_id>`` and add ``/HOST/PREV_STATE`` attribute with same value as that of ``/HOST/STATE``.

We are not able to reproduce the error, any information if you are being hit by this will be very welcome here: https://github.com/OpenNebula/one/issues/4099

.. _known_issues_ruby:

OpenNebula services fail to start
=================================

**Debian and Ubuntu platforms**: It might happen that even when :ref:`front-end installation steps <ruby_runtime>` are followed and when using OpenNebula shipped Ruby gems (i.e., you have a symlink ``/usr/share/one/gems`` present), some OpenNebula services (mainly Sunstone, OneFlow, OneGate) fail to start due to an error in Ruby. It was discovered that Ruby gems installed system-wide via distribution packages might conflict with the gems shipped with the OpenNebula. It's recommended to uninstall any unnecessary Ruby gems installed via packages **from your distribution**.

List Ruby gems installed from distribution packages (prefixed with ``ruby-``), e.g.:

.. prompt:: bash # auto

    # dpkg -l | grep ruby-
    ii  ruby-did-you-mean       1.2.0-2                      all          smart error messages for Ruby > 2.3
    ii  ruby-minitest           5.10.3-1                     all          Ruby test tools supporting TDD, BDD, mocking, and benchmarking
    ii  ruby-net-telnet         0.1.1-2                      all          telnet client library
    ii  ruby-power-assert       0.3.0-1                      all          library showing values of variables and method calls in an expression
    ii  ruby-rack               1.6.4-4ubuntu0.1             all          modular Ruby webserver interface
    ii  ruby-rack-protection    1.5.3-2+deb9u1build0.18.04.1 all          Protects against typical web attacks for Rack apps
    ii  ruby-sinatra            1.4.8-1                      all          Ruby web-development dressed in a DSL
    ii  ruby-test-unit          3.2.5-1                      all          unit testing framework for Ruby
    ii  ruby-tilt               2.0.1-2                      all          Generic interface to multiple Ruby template engines

Review list and uninstall unnecessary ones.

.. important::

    Distribution packages usually causing problems are ``ruby-rack``, ``ruby-rack-protection`` and ``ruby-sinatra``. Run the following command on your front-end to make sure they are not installed (always review the final list of packages to be removed from your system by packager):

    .. prompt:: bash # auto

        # apt-get remove ruby-rack ruby-rack-protection ruby-sinatra

Problem is going to be `fixed <https://github.com/OpenNebula/one/issues/4304>`__ in OpenNebula 5.12.
